{% extends 'admin/admin-index.html'%}
{% block content %}
{% load static %}

<h1 style="text-align: center;">Product List</h1>
    <div class="btns ">
  
         <a href="{% url 'admin_addproduct' %}"> <button class="btn btn-success mt-5">Add Product</button></a>
         <form action="{% url 'prodsearch' %}">
        
          <div class="input-group  "  style="float:right;width: 20rem;">
            <input type="search" class="form-control rounded" placeholder="Search"  name="s" aria-label="Search" aria-describedby="search-addon"  />
            <button type="submit" class="btn btn-outline-primary">search</button>
            <br>
          </div>
        

        </form>
   
    </div>

         <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th scope="col" style="width: 20%">Image</th>
                      <th scope="col" style="width: 20%">Name of the product</th>
                      <!-- <th scope="col">Color</th> -->
                      <th scope="col" style="width: 10%">Category</th>
                      <th scope="col">Stock</th>
                      <th scope="col" style="width: 10%">Price</th>
                      <th scope="col" style="width: 10%">Offer Price</th>
                      <th scope="col" style="width: 15%">Action</th>

                      <th scope="col" style="width: 15%">Offer</th>
                      
                    </tr>
                  </thead>
                  <tbody>
                    {% for i in product %}
                    <tr >
                      
                      <td ><img src="/media/{{i.images}}" alt="..." class=" w-50 h-50"></td>
                      <td>{{i.product_name }}</td>
                      <td>{{ i.category }}</td>
                     <td>{{i.stock}}</td>
                     <td>{{ i.price }}</td>
                     <td>{{i.user_price}}</td>
                      <td>
                           <a href="{% url 'edit_product' i.id %}" ><button class="btn btn-info mb-3" id="my-button" >Edit </button></a><br> 
                           <a href="{% url 'remove_product' i.id  %}" ><button class="btn btn-danger mb-3" id="my-button" >Remove </button></a><br> 
                          <!-- <form action="" method="post">
                            <input name="stock" value="<%= product.stock %>" hidden> -->
                           <!--- <% if ( product.stock) { %>
                              <button type="submit" class="btn btn-danger" >Unlist</button>
                             
                                <%} else { %>
                                 
                                  <button type="submit" class="btn btn-success" >List</button>
                                  <% } %>
                        -- </form> -->

                      </td>
                      <td>
                        {% if i.p_offer == 0 %}
                        <a href="{% url 'addproduct_Offer' i.id %}" ><button class="btn btn-success mb-3" id="my-button" >add </button></a><br> 
                        {% else %}
                           <a href="{% url 'edit_prodOffer' i.id %}" ><button class="btn btn-info mb-3" id="my-button" >Edit </button></a><br> 
                           <button class="btn btn-danger mb-3" onclick="prodOfferRemove('{{i.id}}')" id="my-button" >Remove </button><br> 
                           {% endif %}
                          
                      </td>

                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                <div class="pagi-nav text-right">
                  
                  {% if product.has_other_pages %}
                     {% if product.has_previous %}
                        <a href="?page={{product.previous_page_number}}" class="next"><i class="fa fa-angle-left"></i></a>
                      {% else %}
                           <!-- <a href="#" class="next disabled"><i class="fa fa-angle-left"></i></a> -->
                      {% endif %}

                      {% for i in  product.paginator.page_range %}
                        
                        {% if product.number == i %}
                             <a href="#" class="current">{{i}}</a>
                        {% else %}
                             <a href="?page={{i}}" class="current">{{i}}</a>
                        {% endif %}

                      {% endfor %}
                      {% if product.has_next %}
                       <a href="?page={{product.next_page_number}}" class="next"><i class="fa fa-angle-right"></i></a>
                      {% else %}
                      <!-- <a href="#" class="next disabled"><i class="fa fa-angle-right"></i></a> -->
                       {% endif %}

                       {% endif %}
              </div>


              <script>

                  function prodOfferRemove(id) {
                        let ids = Number(id)
                                  console.log("remove")
                                  console.log(typeof id)
                                  console.log("swaalll");

                                  Swal.fire({
                    
                                    title: 'Are you sure?',
                                    text: "You won't be able to revert this!",
                                    icon: 'warning',
                                    showCancelButton: true,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Yes'

                                  }).then((result) => {

                                    if (result.isConfirmed) {
                                      console.log("ajax");

                                      $.ajax({
                                        url: "{% url  'remove_productOffer' %}",
                                        method: "get",
                                        // headers: {
                                        //   'X-CSRFToken': '{{ csrf_token }}'
                                        // },
                                        data: {
                                          "id": Number(id) 
                                        }
                                      }).done((res) => {
                                        console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
                                        console.log(res)
                                        console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
                                        if(res){

                                          console.log("done");
                                          Swal.fire(
                                            'Successfull!',
                                            'Product Offer is Cancelled!!',
                                            'success'
                                          ).then(() => {
                                            location.reload()
                                            console.log(res.status)
                                            $(status_id).text(res.status)
  
                                          })
                                        }
                                      }).fail((err) => {

                                      })

                                    }
                                  })
                                }

              </script>
                
{% endblock %}